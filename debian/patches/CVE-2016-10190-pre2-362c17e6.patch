From 362c17e6563808ef48655e5ddf59a35b6497b8b2 Mon Sep 17 00:00:00 2001
From: Rodger Combs <rodger.combs@gmail.com>
Date: Sun, 18 Oct 2015 17:50:21 -0500
Subject: [PATCH] lavf/http: fix incorrect warning in range requests

---
 libavformat/http.c | 7 ++++---
 1 file changed, 4 insertions(+), 3 deletions(-)

--- a/libavformat/http.c
+++ b/libavformat/http.c
@@ -703,15 +703,16 @@
         memcpy(buf, s->buf_ptr, len);
         s->buf_ptr += len;
     } else {
+        int64_t target_end = s->end_off ? s->end_off : s->filesize;
         if ((!s->willclose || s->chunksize < 0) &&
-            s->filesize >= 0 && s->off >= s->filesize)
+            target_end >= 0 && s->off >= target_end)
             return AVERROR_EOF;
         len = ffurl_read(s->hd, buf, size);
         if (!len && (!s->willclose || s->chunksize < 0) &&
-            s->filesize >= 0 && s->off < s->filesize) {
+            target_end >= 0 && s->off < target_end) {
             av_log(h, AV_LOG_ERROR,
                    "Streams ends prematurly at %"PRId64", should be %"PRId64"\n",
-                   s->off, s->filesize
+                   s->off, target_end
                   );
             return AVERROR(EIO);
         }
