Origin: https://git.ffmpeg.org/gitweb/ffmpeg.git/commitdiff/8937230719ad7039ff908793f3bb2111e26e4edc
Author: Michael Niedermayer <michaelni@gmx.at>
Reviewed-by: Sylvain Beucler <beuc@debian.org>
Last-Update: 2019-11-08

commit 8937230719ad7039ff908793f3bb2111e26e4edc
Author: Michael Niedermayer <michaelni@gmx.at>
Date:   Thu May 2 16:45:06 2013 +0200

    ape_decode_value_3900: check tmpk
    
    Fixes division by 0
    
    Found-by: Mateusz "j00ru" Jurczyk and Gynvael Coldwind
    Signed-off-by: Michael Niedermayer <michaelni@gmx.at>

Index: libav-11.12/libavcodec/apedec.c
===================================================================
--- libav-11.12.orig/libavcodec/apedec.c
+++ libav-11.12/libavcodec/apedec.c
@@ -541,9 +541,13 @@ static inline int ape_decode_value_3900(
     } else
         tmpk = (rice->k < 1) ? 0 : rice->k - 1;
 
-    if (tmpk <= 16 || ctx->fileversion < 3910)
+    if (tmpk <= 16 || ctx->fileversion < 3910) {
+        if (tmpk > 23) {
+            av_log(ctx->avctx, AV_LOG_ERROR, "Too many bits: %d\n", tmpk);
+            return AVERROR_INVALIDDATA;
+        }
         x = range_decode_bits(ctx, tmpk);
-    else if (tmpk <= 32) {
+    } else if (tmpk <= 32) {
         x = range_decode_bits(ctx, 16);
         x |= (range_decode_bits(ctx, tmpk - 16) << 16);
     } else {
