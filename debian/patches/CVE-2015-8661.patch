From: Michael Niedermayer <michael@niedermayer.cc>
Date: Tue, 24 Nov 2015 21:12:37 +0000 (+0100)
Subject: avcodec/h264_slice: Limit max_contexts when slice_context_count is initialized
X-Git-Tag: n3.0~1433
X-Git-Url: http://git.videolan.org/?p=ffmpeg.git;a=commitdiff_plain;h=4ea4d2f438c9a7eba37980c9a87be4b34943e4d5

avcodec/h264_slice: Limit max_contexts when slice_context_count is initialized

Fixes out of array access
Fixes: 1430e9c43fae47a24c179c7c54f94918/signal_sigsegv_421427_2049_f2192b6829ab6e0eefcb035329c03c60.264

Found-by: Mateusz "j00ru" Jurczyk and Gynvael Coldwind
Signed-off-by: Michael Niedermayer <michael@niedermayer.cc>
---

--- a/libavcodec/h264_slice.c
+++ b/libavcodec/h264_slice.c
@@ -1118,6 +1118,7 @@
         nb_slices = max_slices;
     }
     h->slice_context_count = nb_slices;
+    h->max_contexts = FFMIN(h->max_contexts, nb_slices);
 
     if (!HAVE_THREADS || !(h->avctx->active_thread_type & FF_THREAD_SLICE)) {
         ret = ff_h264_context_init(h);
