From: Michael Niedermayer <michael@niedermayer.cc>
Date: Thu, 16 Jul 2015 09:52:33 +0000 (+0200)
Subject: avcodec/pthread_frame: clear priv_data, avoid stale pointer in error case
X-Git-Tag: n2.8~1010
X-Git-Url: http://git.videolan.org/?p=ffmpeg.git;a=commitdiff_plain;h=f1a38264f20382731cf2cc75fdd98f4c9a84a626

avcodec/pthread_frame: clear priv_data, avoid stale pointer in error case

Fixes: b4b47bc2b3fb7ca710bfffe5aa969e37_signal_sigabrt_7ffff70eccc9_744_nc_sample2.avi with memlimit of 4194304

Found-by: Samuel Gro√ü, Mateusz "j00ru" Jurczyk and Gynvael Coldwind
Signed-off-by: Michael Niedermayer <michael@niedermayer.cc>
---

--- a/libavcodec/pthread_frame.c
+++ b/libavcodec/pthread_frame.c
@@ -616,6 +616,7 @@
 
         copy->internal = av_malloc(sizeof(AVCodecInternal));
         if (!copy->internal) {
+            copy->priv_data = NULL;
             err = AVERROR(ENOMEM);
             goto error;
         }
