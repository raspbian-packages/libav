From: Michael Niedermayer <michael@niedermayer.cc>
Date: Mon, 13 Jul 2015 14:05:21 +0000 (+0200)
Subject: avcodec/sanm: Reset sizes in destroy_buffers()
X-Git-Tag: n2.8~1072
X-Git-Url: http://git.videolan.org/?p=ffmpeg.git;a=commitdiff_plain;h=39bbdebb1ed8eb9c9b0cd6db85afde6ba89d86e4

avcodec/sanm: Reset sizes in destroy_buffers()

Fixes crash in 1288a2fe8e9ae6b00ca40e089d08ca65_signal_sigsegv_7ffff71426a7_354_accident.san with allocation limit 65536

Found-by: Samuel Gro√ü, Mateusz "j00ru" Jurczyk and Gynvael Coldwind
Signed-off-by: Michael Niedermayer <michael@niedermayer.cc>
---

--- a/libavcodec/sanm.c
+++ b/libavcodec/sanm.c
@@ -406,6 +406,7 @@
     ctx->frm0_size =
     ctx->frm1_size =
     ctx->frm2_size = 0;
+    init_sizes(ctx, 0, 0);
 }
 
 static av_cold int init_buffers(SANMVideoContext *ctx)
